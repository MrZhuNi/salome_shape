## Copyright (C) 2014-20xx CEA/DEN, EDF R&D

INCLUDE(Common)

SET(PROJECT_HEADERS
    ModelHighAPI.h
    ModelHighAPI_Double.h
    ModelHighAPI_Interface.h
    )

SET(PROJECT_SOURCES
    ModelHighAPI_Double.cpp
    ModelHighAPI_Interface.cpp
    )

SET(PROJECT_LIBRARIES
    Config
    Events
    )

ADD_DEFINITIONS(-DMODELHIGHAPI_EXPORTS)
ADD_LIBRARY(ModelHighAPI SHARED ${PROJECT_SOURCES} ${PROJECT_HEADERS})
#TODO(spo): is it necessary?
SET_TARGET_PROPERTIES(ModelHighAPI PROPERTIES LINKER_LANGUAGE CXX)
TARGET_LINK_LIBRARIES(ModelHighAPI ${PROJECT_LIBRARIES})

# SWIG wrapper

INCLUDE(PythonAPI)

#TODO(spo): is it necessary?
SET(CMAKE_SWIG_FLAGS -threads -Wall)

SET_SOURCE_FILES_PROPERTIES(ModelHighAPI.i PROPERTIES CPLUSPLUS ON)
SET_SOURCE_FILES_PROPERTIES(ModelHighAPI.i PROPERTIES SWIG_DEFINITIONS "-shadow")

SET(SWIG_LINK_LIBRARIES
    ModelHighAPI
    ${PYTHON_LIBRARIES}
    )

INCLUDE_DIRECTORIES(
    ${PROJECT_SOURCE_DIR}/src/Events
    ${PROJECT_SOURCE_DIR}/src/ModelAPI
#                    ${PROJECT_SOURCE_DIR}/src/GeomAPI
#                    ${PROJECT_SOURCE_DIR}/src/GeomAlgoAPI
)

SET(SWIG_SCRIPTS
    ${CMAKE_CURRENT_BINARY_DIR}/ModelHighAPI.py
    )

SWIG_ADD_MODULE(ModelHighAPI python ModelHighAPI.i ${PROJECT_HEADERS})
SWIG_LINK_LIBRARIES(ModelHighAPI ${SWIG_LINK_LIBRARIES})

IF(WIN32)
  SET_TARGET_PROPERTIES(_ModelHighAPI PROPERTIES DEBUG_OUTPUT_NAME _ModelHighAPI_d)
ENDIF(WIN32)

INSTALL(TARGETS _ModelHighAPI DESTINATION ${SHAPER_INSTALL_SWIG})
INSTALL(TARGETS ModelHighAPI DESTINATION ${SHAPER_INSTALL_BIN})
INSTALL(FILES ${SWIG_SCRIPTS} DESTINATION ${SHAPER_INSTALL_SWIG})

# Tests

INCLUDE(UnitTest)

ADD_UNIT_TESTS(
    TestDouble.py
    )
